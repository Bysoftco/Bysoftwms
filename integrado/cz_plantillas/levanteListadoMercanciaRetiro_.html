<script>
  $(function() {
    $('#btnAdicionales').hide();
    $("a.id_mercancia").click(function() { //check for the first selection
      var $column = $(this).attr('id'); // assign the ID of the column

      with (document.listadoMercancia) {
        if(($("#do_bloqueo" + $column).val()/1)==1) {
          alert("Una Orden BLOQUEADA no puede tener movimientos mientras este en este estado !!.");
          return 0;
        }
        // se debe enviar el codigo referencia y el cliente y el max id
        var cod_ref = $("#cod_ref" + $column).val();
        var id_item = $("#id_item_ret" + $column).val();
        //var tipo_movimiento = $("#tipo_movimiento" + $column).val();
				var tipo_movimiento = $("#tipo_movimiento_fijo").val();
        var una_orden = $("#orden_retiro" + $column).val();
				var orden_detalle = $("#orden_detalle" + $column).val();
        
        if($("#placa").val() == "" && tipo_movimiento == 3) {
          alert("Antes de hacer un retiro debe ingresar los datos del retiro")
          $('#tabs').tabs("select", 0);
        } else {
          //alert($('#una_matriz').val());
          switch(tipo_movimiento / 1) {
            case 3: // Retiro
            case 7: // Alistamiento
              getmetodo = 'getItemRetiro';    // metodo que trae el formulario que abre
              sendmetodo = 'addItemRetiro' // metodo que recibe el formulario al enviarlo
              break;
            case 8://Proceso
              getmetodo = 'getItemRetiro';    // metodo que trae el formulario que abre
              sendmetodo = 'addItemProceso' // metodo que recibe el formulario al enviarlo
              break;
            case 9://Ensable
              getmetodo = 'getItemProceso';
              sendmetodo = 'addItemEnsamble'
              $('#btnAdicionales').show();
              break;
            case 13://Endoso
              var cantidad = $("#cant_reg").val();
              
							if(cantidad >= 1) {
                alert('Solo puede endosar un DO a la vez');
								return 0;
							}
							getmetodo = 'getItemRetiro';    // metodo que trae el formulario que abre
              sendmetodo = 'addItemRetiro' // metodo que recibe el formulario al enviarlo
              break;	
            default:
              getmetodo = 'getItemRetiro';    // metodo que trae el formulario que abre
              sendmetodo = 'addItemRetiro' // metodo que recibe el formulario al enviarlo
          }
          //alert({referencia_filtro})	
          //alert('{guia_aux}');
          $("#dialog-form-hacer-levante").dialog("open");
          $("#ventana_levante").html("Espere un momento....");
          //marca matriz y otras variables estan en levante maestro.html:: Informacion adicional de TRACKING
          $("div#ventana_levante").load("./scripts_index.php", { clase: 'Levante', metodo: getmetodo, mostrar: '1',
            id_item: id_item, id_levante: $("#id_levante").val(),
            tipo_retiro_filtro: $("#tipo_retiro_filtro").val(),
            orden_retiro: una_orden, sendmetodo: sendmetodo, tipo_movimiento: tipo_movimiento,
            cod_ref: cod_ref, por_cuenta_filtro: $("#por_cuenta_aux").val(),orden_detalle:orden_detalle,accion_aux:'{metodo}',
            una_matriz:$('#una_matriz').val(),filtro_guia_aux:'{guia_aux}',referencia_filtro:'{referencia_filtro}',
            modelo_filtro:'{modelo_filtro}',marca_matriz:$('#marca_matriz').val(),email:$("#email_aux").val(),
            nombre_cliente:$("#nombre_cliente").val(),nombre_movimiento:$("#nombre_movimiento").val(),
            fecha:$("#fecha").val(),conductor:$("#conductor").val(),placa:$("#placa").val(),
            destinatario:$("#destinatario").val(),ciudad:$("#ciudad").val(),direccion:$("#direccion").val()}, function(datos) {
            //alert(datos)
          });
        }// sin si lleno cabecera  
      }
    });
    $(":submit").button();
  });
</script>
<style>
  .ui-button { margin-left: -1px; }
  .ui-button-icon-only .ui-button-text { padding: 0.35em; } 
  .ui-autocomplete-input { margin: 0; padding: 0.48em 0 0.47em 0.45em; width:200px;}
  #formularioEditar label.error, #formularioEditar button.submit { margin-left: 0px; }
</style>
<link rel="stylesheet" type="text/css" href="./_estilos/jquery.autocomplete.css" />
<div id="users-contain" class="ui-widget" > 
  <form id="listadoMercancia" name="listadoMercancia">   
    <fieldset class="ui-widget ui-widget-content ui-corner-all">
      <legend class="ui-widget ui-widget-header ui-corner-all"> Datos de la Mercanc&iacute;a</legend>
      <span id="msgbox_mercancia_retiro" style="display:block" class="{estilo}"> {mensaje} </span>
      <table width="100%" class="ui-widget ui-widget-content" id="users" style="display:{mostrarCuerpo}">
        <thead>
          <tr class="ui-widget-header "> 
            <th >#</th>
            <th >Orden</th>
            <th >DocTTE</th>
            <th >Mercanc&iacute;a
              <input name="es_matriz" type="hidden" id="es_matriz" value="{es_matriz}" />
                {es_matrizX}
              <input name="guia_filtro_aux" type="hidden" id="guia_filtro_aux" value="{guia_aux}" />
            </th>
            <th >Cantidad</th>
            <th >Peso</th>
            <th >Cif{ext}</th>
            <th >Acci&oacute;n
              <input name="n" type="hidden" id="n" value="{num_registros}" />
              <input name="id_tab" type="hidden" id="id_tab" value="{id_tab}" /> 
            </th>
          </tr>
        </thead>
        <tbody>
          {comodin} 
          <!-- BEGIN ROW -->
          <tr class="{odd}"> 
        <td width="1%" >{n}</td>
                        <td> <div id="label_concepto{n}">{orden}
                <input name="orden_retiro[]" type="hidden" id="orden_retiro{n}" value="{orden}" />
                <input name="orden_detalle{n}" type="hidden" id="orden_detalle{n}" value="{orden}" />
                <a href="#" class="signup id_mercancia" title="Nuevo Levante {n}" id="{n}" cursor> 
                </a>
              </div>
            </td>
            <td>{doc_tte_aux}</td>
            <td> [{cod_referencia}]{nombre_referencia} 
              <input name="item[]" type="hidden" id="id_item_ret{n}" value="{item}" /> 
              <input name="tip_mov[]" type="hidden" id="tipo_movimiento{n}" value="{tipo_movimiento}" /> 
              <input name="cod_ref[]" type="hidden" id="cod_ref{n}" value="{codigo_referencia}" />
              <input name="do_bloqueo[]" type="hidden" id="do_bloqueo{n}" value="{bloqueado}" />
            </td>
            <td>{cant_naci_f} {sn}{cant_nonac_f}</td>
            <td>{peso_naci_f} {sn}{peso_nonac_f}</td>
            <td>{cif_f} {sn}{fob_nonac_f} 
              <div id="lab_valores{n}" class="ui-priority-primary"></div>
            </td>
            <td>
              <a href="#" class="signup id_mercancia" title="Agregar Mercancia {n}" id="{n}" cursor>
                <img src="integrado/imagenes/{imagen}" width="25" height="25" border="1" /> 
              </a>
            </td>
          </tr>
          <!-- END ROW -->
          <tr> 
            <td>Totales</td>
            <td>{n}</td>
            <td>&nbsp;</td>
            <td>{n}</td>
            <td>{tot_cant_nac}{snt}{tot_cant_nonac}</td>
            <td>{tot_peso_nac}{snt}{tot_peso_nonac}</td>
            <td>{tot_cif}{snt}{total_fob}</td>
            <td>{n}</td>
          </tr>
          <input name="num_registros" type="hidden" id="num_registros" value="{num_registros}" />
        </tbody>
      </table>
    </fieldset>
    <input type="hidden" name="email" id="email_aux" value="{email}" />
    <input type="hidden" name="nombre_cliente" id="nombre_cliente" value="{cliente}" />
    <input type="hidden" name="nombre_movimiento" id="nombre_movimiento" value="{nombre_movimiento}" />
    <input type="hidden" name="fecha" id="fecha" value="{fecha}" />
    <input type="hidden" name="conductor" id="conductor" value="{conductor}" />
    <input type="hidden" name="placa" id="placa" value="{placa}" />
    <input type="hidden" name="destinatario" id="destinatario" value="{destinatario}" />
    <input type="hidden" name="ciudad" id="ciudad" value="{ciudad}" />
    <input type="hidden" name="direccion" id="direccion" value="{direccion}" />
  </form>
</div>